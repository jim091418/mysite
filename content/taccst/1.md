+++
title = '場次1'
date = 2024-09-13T06:13:15-04:00
+++

# 事前聲明
因為本人金魚腦，因此希望能用個記事來記錄曾經滲透過的經驗，標題順序並非個人檢測場次的順序，想到就寫。
# 事前Recon
- 主要網站架構ASP.NET
- subfinder並未找到太多標的
- 有幾個旁系網站API並未做好權限控管
- 大多套件都有更新，只有少數JS未更新至最新版本
- 大多管理介面有依照防護基準
# 滲透當天
其實看到主要網站是ASP.NET心理就感覺這場只能寫寫版本過舊or Cookie Header未設定之類的漏洞了，但當天還是有做了一下掙扎，有測試XSS、IDOR、SQLi、CSRF、SSTI、Path Traversal測試。
- XSS  
一開始是使用paraspider抓參數，在使用dalfox去弄，但這樣通常是用網站外面(未登入)，並且有多個重複的注入點，優點就是放著給他跑就好，缺點就是時間很長，但在這一步沒有找到東西。  
後面是使用登陸後的管理者介面在配上Burp Suite+XSS Payload(6xxx多條)有發現一個可以用的，其實當初在手動注入的時候發現網站有block<s、javascript:alert(1)、<img...etc，再看到有阻擋偽協議的時候，心裡就覺得xss沒啥機會了，但網路上的XSS Payload真的很厲害，裡面當中真的就有一條可以bypass，並且是我沒有看過的方式。在最後的時候就靠著這條Payload打到一個Dom XSS。
- IDOR  
本來在找是否有id=1或是downloadfile=1這種，有找到download的注入點，但使用chatgpt寫了一個腳本後，只下載到一堆合法的資料，並未有任何收穫。後續有把管理者的介面網址貼到使用者權限的瀏覽器上面，並未找到權限設置錯誤的網頁。  
- SQLi  
看到.NET寫的網頁其實就沒有很想要測試SQLi了，我這個只有使用管理者的cookie去跑crawl=2，並且在外面使用paraspider再搭配sqlmapapi去跑，都沒結果就放棄。
- CSRF  
與SQLi一樣，使用Burp Suite有看到.NET內建的CSRF Token，有想說有沒有可能失效(死馬當活馬醫的概念)，測試過一次失敗即放棄。
- SSTI  
其實對這個漏洞並沒有很深刻的了解，是有夥伴有在之前有打過成功這個漏洞，在Port Swigger練習過幾題，我在一些地方下一些測試語法{{7\*7}}、${7\*7}，都沒結果後放棄。
- Path Traversal  
這個也基本上必做的，因在旁系網站有找到一些問題，並且有看到這個網站有使用FCKeditor，對著步驟本來想說有機會的，但一樣列舉完沒找到問題即放棄。

# 心得
這次利用網路上大神的XSS Payload拿到first blood，真的XSS無奇不有，看到成功的Payload才知道有這種組合方式，果然阻擋XSS比較好的方式還是詳盡的CSP+網路上現成的套件，如果自己寫真的無法涵蓋住全部的問題!
